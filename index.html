<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="site-title">Loading...</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Space+Grotesk:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <link rel="stylesheet" href="style.css">
    <style>
        /* Loader styles to hide content until loaded */
        body.loading {
            overflow: hidden;
        }

        #loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: #ffffff;
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s ease;
        }

        .loader-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary-color, #7c3aed);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body class="loading">
    <!-- Loader -->
    <div id="loader">
        <div class="loader-spinner"></div>
    </div>

    <!-- Physics Canvas -->
    <canvas id="particle-canvas"></canvas>

    <!-- Apple-style Scrollbar -->
    <div class="scrollbar-track" id="scrollbar-track">
        <div class="scrollbar-thumb" id="scrollbar-thumb"></div>
    </div>

    <!-- Header Section -->
    <header class="header">
        <div class="container">
            <a href="#" class="logo" id="site-logo">Loading...</a>
            <nav class="navbar" id="site-nav">
                <!-- Nav items injected here -->
            </nav>
            <div class="mobile-toggle">
                <i class="fa-solid fa-bars"></i>
            </div>
        </div>
    </header>

    <div class="scroll-container" id="scroll-container">



        <!-- Hero Section -->
        <section id="hero" class="hero">
            <div class="container hero-container">
                <div class="hero-content fade-in-up">
                    <span class="subtitle">Hello, I'm</span>
                    <h1 class="title" id="hero-name">Loading...</h1>
                    <p class="description" id="hero-desc">
                        Loading...
                    </p>
                    <div class="hero-btns">
                        <a href="#portfolio" class="btn btn-primary ripple">View My Work</a>
                        <a href="#contact" class="btn btn-outline ripple">Contact Me</a>
                    </div>
                    <div class="social-links" id="hero-social">
                        <!-- Social links injected here -->
                    </div>
                </div>
                <div class="hero-visual fade-in-left">
                    <div class="blob"></div>
                    <div class="blob blob-2"></div>
                    <div class="profile-img-container floating">
                        <img src="" alt="Profile" id="hero-img">
                    </div>
                </div>
            </div>
        </section>

        <!-- About Section -->
        <section id="about" class="section about">
            <div class="container">
                <div class="section-header reveal">
                    <span class="section-subtitle" id="about-subtitle"></span>
                    <h2 class="section-title" id="about-title"></h2>
                </div>
                <div class="about-content reveal">
                    <div class="about-text" id="about-text">
                        <!-- About text injected here -->
                    </div>
                    <!-- Stats container moved inside about-content for better layout control if needed, 
                     but keeping structure similar to previous for now, just dynamic -->
                </div>
                <div class="stats reveal" id="about-stats">
                    <!-- Stats injected here -->
                </div>
            </div>
        </section>

        <!-- Skills Section -->
        <section id="skills" class="section skills">
            <div class="container">
                <div class="section-header reveal">
                    <span class="section-subtitle" id="skills-subtitle"></span>
                    <h2 class="section-title" id="skills-title"></h2>
                </div>
                <div class="skills-grid" id="skills-grid">
                    <!-- Skills injected here -->
                </div>
            </div>
        </section>

        <!-- Portfolio Section -->
        <section id="portfolio" class="section portfolio">
            <div class="container">
                <div class="section-header reveal">
                    <span class="section-subtitle" id="portfolio-subtitle"></span>
                    <h2 class="section-title" id="portfolio-title"></h2>
                </div>
                <div class="portfolio-grid" id="portfolio-grid">
                    <!-- Projects injected here -->
                </div>
            </div>
        </section>

        <!-- Contact Section -->
        <section id="contact" class="section contact">
            <div class="container">
                <div class="section-header reveal">
                    <span class="section-subtitle" id="contact-subtitle"></span>
                    <h2 class="section-title" id="contact-title"></h2>
                </div>
                <div class="contact-wrapper reveal">
                    <div class="contact-info" id="contact-info">
                        <!-- Contact info injected here -->
                    </div>
                    <form class="contact-form" id="contact-form">
                        <!-- Security honey-pot -->
                        <div style="display:none;">
                            <input type="text" name="honey_pot" id="honey-pot">
                        </div>

                        <div class="form-group">
                            <label class="floating-label">Name</label>
                            <input type="text" id="contact-name" name="user_name" required placeholder="John Doe">
                        </div>
                        <div class="form-group">
                            <label class="floating-label">Email</label>
                            <input type="email" id="contact-email" name="user_email" required
                                placeholder="john@example.com">
                        </div>
                        <div class="form-group">
                            <label class="floating-label">Subject</label>
                            <input type="text" id="contact-subject" name="subject" placeholder="Project Inquiry">
                        </div>
                        <div class="form-group">
                            <label class="floating-label">Message</label>
                            <textarea id="contact-message" name="message" rows="5" required
                                placeholder="How can I help you?"></textarea>
                        </div>
                        <div id="contact-status" class="contact-status"></div>
                        <button type="submit" class="btn btn-primary ripple" id="submit-btn">
                            <i class="fa-solid fa-paper-plane"></i>
                            <span>Send Message</span>
                        </button>
                    </form>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <div class="container footer-content">
                <div class="footer-social" id="footer-social">
                    <!-- Social links injected here -->
                </div>
                <p id="footer-text" class="footer-text"></p>
                <div class="footer-links">
                    <a href="terms.html">Terms of Service</a>
                    <span class="separator">â€¢</span>
                    <a href="privacy.html">Privacy Policy</a>
                </div>
            </div>
        </footer>
    </div> <!-- End .scroll-container -->

    <!-- Image Modal -->
    <div id="image-modal" class="image-modal">
        <div class="modal-backdrop"></div>
        <button class="modal-close"><i class="fa-solid fa-xmark"></i></button>
        <div class="modal-content">
            <img src="" alt="Profile Full" id="modal-img">
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const loader = document.getElementById('loader');

            // Fetch Data
            fetch('data.json')
                .then(response => response.json())
                .then(data => {
                    populateSite(data.site, data.profile); // Pass profile for footer socials
                    populateHero(data.profile);
                    populateAbout(data.about);
                    populateSkills(data.skills);
                    populateProjects(data.projects);
                    populateContact(data.contact);

                    // Hide loader after a small delay to ensure assets are ready
                    setTimeout(() => {
                        loader.style.opacity = '0';
                        setTimeout(() => {
                            loader.style.display = 'none';
                            document.body.classList.remove('loading');
                            initAnimations();
                        }, 500);
                    }, 800);
                })
                .catch(error => {
                    console.error('Error loading data:', error);
                    loader.innerHTML = '<p style="color:white; text-align:center; padding-top: 20px;">Error loading content. Please run a local server.</p>';
                });

            // Mobile Navigation Toggle
            const mobileToggle = document.querySelector('.mobile-toggle');
            const navbar = document.querySelector('.navbar');

            mobileToggle.addEventListener('click', () => {
                navbar.classList.toggle('active');
                const icon = mobileToggle.querySelector('i');
                if (navbar.classList.contains('active')) {
                    icon.classList.remove('fa-bars');
                    icon.classList.add('fa-xmark');
                } else {
                    icon.classList.remove('fa-xmark');
                    icon.classList.add('fa-bars');
                }
            });

            // Close menu when clicking a link
            document.querySelectorAll('.navbar a').forEach(link => {
                link.addEventListener('click', () => {
                    navbar.classList.remove('active');
                    const icon = mobileToggle.querySelector('i');
                    icon.classList.remove('fa-xmark');
                    icon.classList.add('fa-bars');
                });
            });

            // Ripple Effect for Buttons
            document.querySelectorAll('.ripple').forEach(btn => {
                btn.addEventListener('click', function (e) {
                    let x = e.clientX - e.target.offsetLeft;
                    let y = e.clientY - e.target.offsetTop;
                    let ripples = document.createElement('span');
                    ripples.classList.add('ripple-span');
                    ripples.style.left = x + 'px';
                    ripples.style.top = y + 'px';
                    this.appendChild(ripples);
                    setTimeout(() => {
                        ripples.remove();
                    }, 1000);
                });
            });
        });

        function populateSite(site, profile) { // Pass profile data too
            document.getElementById('site-title').textContent = site.title;

            const logo = document.getElementById('site-logo');
            logo.innerHTML = `${site.logo.text}<span>${site.logo.span}</span>`;

            const nav = document.getElementById('site-nav');
            site.nav.forEach((item, index) => {
                const a = document.createElement('a');
                a.href = item.link;
                a.textContent = item.label;
                if (index === 0) a.classList.add('active');
                nav.appendChild(a);
            });

            // Populate Section Titles
            Object.keys(site.sections).forEach(key => {
                const section = site.sections[key];
                const subtitle = document.getElementById(`${key}-subtitle`);
                const title = document.getElementById(`${key}-title`);
                if (subtitle) subtitle.textContent = section.subtitle;
                if (title) title.textContent = section.title;
            });

            document.getElementById('footer-text').innerHTML = site.footer;

            // Populate Footer Socials (from profile data)
            const footerSocial = document.getElementById('footer-social');
            if (footerSocial && profile && profile.social) {
                profile.social.forEach(link => {
                    const a = document.createElement('a');
                    a.href = link.url;
                    a.innerHTML = `<i class="${link.icon}"></i>`;
                    footerSocial.appendChild(a);
                });
            }
        }

        function populateHero(profile) {
            document.getElementById('hero-name').textContent = profile.name;
            document.getElementById('hero-desc').textContent = profile.description;
            // Set profile image
            const heroImg = document.getElementById('hero-img');
            if (profile.profileImage) {
                heroImg.src = profile.profileImage;
                heroImg.alt = profile.name;
            } else {
                heroImg.parentElement.style.display = 'none'; // Hide if no image
            }

            const socialContainer = document.getElementById('hero-social');
            profile.social.forEach(link => {
                const a = document.createElement('a');
                a.href = link.url;
                a.innerHTML = `<i class="${link.icon}"></i>`;
                socialContainer.appendChild(a);
            });

            // Modal logic
            const modal = document.getElementById('image-modal');
            const modalImg = document.getElementById('modal-img');
            const profileContainer = document.querySelector('.profile-img-container');

            if (profileContainer && modal && modalImg) {
                profileContainer.addEventListener('click', () => {
                    const heroImg = document.getElementById('hero-img');
                    if (heroImg && heroImg.src) {
                        modalImg.src = heroImg.src;
                        modal.classList.add('active');
                        document.body.style.overflow = 'hidden'; // Prevent scroll
                    }
                });

                modal.addEventListener('click', () => {
                    modal.classList.remove('active');
                    document.body.style.overflow = ''; // Restore scroll
                });
            }
        }

        function populateAbout(about) {
            const textContainer = document.getElementById('about-text');
            about.text.forEach(p => {
                const para = document.createElement('p');
                para.textContent = p;
                textContainer.appendChild(para);
            });

            const statsContainer = document.getElementById('about-stats');
            about.stats.forEach(stat => {
                const div = document.createElement('div');
                div.className = 'stat-item';
                div.innerHTML = `<h3>${stat.value}</h3><p>${stat.label}</p>`;
                statsContainer.appendChild(div);
            });
        }

        function populateSkills(skills) {
            const grid = document.getElementById('skills-grid');
            skills.forEach((skill, index) => {
                const card = document.createElement('div');
                card.className = 'skill-card reveal';
                card.style.transitionDelay = `${index * 120}ms`; // Increased delay
                card.innerHTML = `
                    <i class="${skill.icon}"></i>
                    <h3>${skill.name}</h3>
                    <p>${skill.desc}</p>
                `;
                grid.appendChild(card);
            });
        }

        function populateProjects(projects) {
            const grid = document.getElementById('portfolio-grid');
            projects.forEach((project, index) => {
                const card = document.createElement('div');
                card.className = 'project-card reveal';
                card.style.transitionDelay = `${index * 200}ms`; // Increased delay
                card.innerHTML = `
                    <div class="project-img">
                        <div class="img-placeholder" style="background: ${project.imageGradient};"></div>
                    </div>
                    <div class="project-content">
                        <span class="category">${project.category}</span>
                        <h3>${project.title}</h3>
                        <p>${project.description}</p>
                        <a href="${project.link}" class="read-more">View Details <i class="fa-solid fa-arrow-right"></i></a>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function populateContact(contact) {
            const infoContainer = document.getElementById('contact-info');
            const icons = {
                location: 'fa-location-dot',
                email: 'fa-envelope',
                phone: 'fa-phone'
            };

            Object.keys(contact).forEach(key => {
                const div = document.createElement('div');
                div.className = 'info-item';
                div.innerHTML = `
                    <i class="fa-solid ${icons[key]}"></i>
                    <div>
                        <h4>${key.charAt(0).toUpperCase() + key.slice(1)}</h4>
                        <p>${contact[key]}</p>
                    </div>
                `;
                infoContainer.appendChild(div);
            });
        }

        // Advanced "Antigravity" Flow Field System
        const canvas = document.getElementById('particle-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let particles = [];
        const particleCount = 200; // Reduced for cleaner look

        // Light Theme Palette (Dark Grey/Black)
        const colors = ['rgba(0, 0, 0, 0.8)', 'rgba(0, 0, 0, 0.5)', 'rgba(32, 33, 36, 0.6)', 'rgba(0, 0, 0, 0.2)'];

        const mouse = {
            x: null,
            y: null,
            radius: 200
        }

        let time = 0;

        window.addEventListener('mousemove', (event) => {
            mouse.x = event.x;
            mouse.y = event.y;
        });

        window.addEventListener('mouseout', () => {
            mouse.x = undefined;
            mouse.y = undefined;
        });

        class Particle {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.size = Math.random() * 1.5 + 0.1; // Very fine dots, like stars
                this.color = colors[Math.floor(Math.random() * colors.length)];

                this.vx = 0;
                this.vy = 0;
                this.maxSpeed = Math.random() * 0.5 + 0.2;

                this.angle = 0;
            }

            update() {
                // Flow Field Logic (Simulated Noise)
                // Calculate an angle based on position and time
                const xNoise = this.x * 0.002;
                const yNoise = this.y * 0.002;
                const timeNoise = time * 0.0005;

                // Complex wave function to simulate perlin noise flow
                const angle = (Math.cos(xNoise + timeNoise) + Math.sin(yNoise + timeNoise)) * Math.PI;

                // Acceleration based on flow angle
                this.vx += Math.cos(angle) * 0.02;
                this.vy += Math.sin(angle) * 0.02;

                // Mouse Attraction (Antigravity Pull)
                if (mouse.x != undefined) {
                    let dx = mouse.x - this.x;
                    let dy = mouse.y - this.y;
                    let distance = Math.sqrt(dx * dx + dy * dy);

                    if (distance < mouse.radius * 2) {
                        let force = (mouse.radius - distance) / mouse.radius;
                        if (force < 0) force = 0;

                        // Swirl/Orbit effect
                        // Pull towards
                        this.vx += (dx / distance) * force * 0.1;
                        this.vy += (dy / distance) * force * 0.1;
                    }
                }

                // Speed Limit
                const currentSpeed = Math.sqrt(this.vx * this.vx + this.vy * this.vy);
                if (currentSpeed > this.maxSpeed) {
                    this.vx = (this.vx / currentSpeed) * this.maxSpeed;
                    this.vy = (this.vy / currentSpeed) * this.maxSpeed;
                }

                this.x += this.vx;
                this.y += this.vy;

                // Wrap around with buffer
                if (this.x > canvas.width + 5) this.x = -5;
                else if (this.x < -5) this.x = canvas.width + 5;
                if (this.y > canvas.height + 5) this.y = -5;
                else if (this.y < -5) this.y = canvas.height + 5;
            }

            draw() {
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function initParticles() {
            particles = [];
            for (let i = 0; i < particleCount; i++) {
                particles.push(new Particle());
            }
        }

        function animateParticles() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            time++; // Increment time for flow field animation

            for (let i = 0; i < particles.length; i++) {
                particles[i].update();
                particles[i].draw();
            }
            requestAnimationFrame(animateParticles);
        }

        initParticles();
        animateParticles();

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            initParticles();
            // Upadte height on resize
            if (document.getElementById('scroll-container')) {
                document.body.style.height = `${document.getElementById('scroll-container').getBoundingClientRect().height}px`;
            }
        });

        // Logic for Smart Sticky Header
        const header = document.querySelector('.header');
        let lastScrollY = window.scrollY;

        // Native Scroll Handler
        window.addEventListener('scroll', () => {
            const currentScroll = window.scrollY;

            // Smart Header Logic
            // As requested: Scroll Up -> Hide, Scroll Down -> Show
            if (header) {
                if (currentScroll > lastScrollY && currentScroll > 50) {
                    // Scrolling Down -> Show Header
                    header.classList.remove('hidden');
                } else if (currentScroll < lastScrollY && currentScroll > 50) {
                    // Scrolling Up -> Hide Header
                    header.classList.add('hidden');
                } else if (currentScroll <= 50) {
                    // At the top -> Always Show
                    header.classList.remove('hidden');
                }

                // Muted Header Style
                if (currentScroll > 50) {
                    header.classList.add('scrolled');
                } else {
                    header.classList.remove('scrolled');
                }
            }

            lastScrollY = currentScroll;

            // Scroll Spy Logic
            const sections = document.querySelectorAll('section');
            const navLi = document.querySelectorAll('.navbar a');

            let currentSection = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.clientHeight;
                if (window.scrollY >= (sectionTop - sectionHeight / 3)) {
                    currentSection = section.getAttribute('id');
                }
            });

            navLi.forEach(a => {
                a.classList.remove('active');
                if (a.getAttribute('href').includes(currentSection)) {
                    a.classList.add('active');
                }
            });
        });

        // Intersection Observer for Scroll Animations
        function initAnimations() {
            const observerOptions = {
                threshold: 0.1
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('active');
                        observer.unobserve(entry.target);
                    }
                });
            }, observerOptions);

            document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
        }
        // Form Handling with EmailJS
        (function () {
            // REPLACE 'YOUR_PUBLIC_KEY' with your actual EmailJS public key
            emailjs.init("YOUR_PUBLIC_KEY");

            const contactForm = document.getElementById('contact-form');
            const submitBtn = document.getElementById('submit-btn');
            const statusMsg = document.getElementById('contact-status');
            const honeyPot = document.getElementById('honey-pot');

            if (contactForm) {
                contactForm.addEventListener('submit', function (event) {
                    event.preventDefault();

                    // Security check: Honey-pot
                    if (honeyPot && honeyPot.value !== "") {
                        console.log("Bot detected");
                        return;
                    }

                    // Reset status
                    statusMsg.className = 'contact-status';
                    statusMsg.textContent = '';

                    // Button Loading State
                    const originalBtnContent = submitBtn.innerHTML;
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i><span>Sending...</span>';

                    // Prepare template parameters
                    // These variables must match your EmailJS template!
                    const templateParams = {
                        from_name: document.getElementById('contact-name').value,
                        from_email: document.getElementById('contact-email').value,
                        subject: document.getElementById('contact-subject').value,
                        message: document.getElementById('contact-message').value
                    };

                    // Send Email using EmailJS
                    // REPLACE 'YOUR_SERVICE_ID' and 'YOUR_TEMPLATE_ID'
                    emailjs.send('YOUR_SERVICE_ID', 'YOUR_TEMPLATE_ID', templateParams)
                        .then(function () {
                            statusMsg.classList.add('success');
                            statusMsg.textContent = 'Message sent successfully! I will get back to you soon.';
                            contactForm.reset();
                        }, function (error) {
                            console.error('EmailJS Error:', error);
                            statusMsg.classList.add('error');
                            statusMsg.textContent = 'Failed to send message. Please try again or contact me directly.';
                        })
                        .finally(function () {
                            submitBtn.disabled = false;
                            submitBtn.innerHTML = originalBtnContent;
                        });
                });
            }
        })();
    </script>
</body>

</html>